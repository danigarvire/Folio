/* ===============================================================
   ROOT
=============================================================== */

.novelist-view {
  padding: 16px;
  font-size: 14px;
  display: flex;
  flex-direction: column;
  gap: 0; /* Book-Smith pattern: group then space, not global gap */
  height: 100%;
  flex: 1 1 auto;
  box-sizing: border-box;
  overflow-x: hidden; /* prevent horizontal scrollbar from small overflows */
}

/* Novelist theme tints (single source of truth for cover/header/stats) */
:root {
  /* Use the editor background RGB as the base so tints match the editor zone shade */
  --novelist-tint-light: rgba(var(--background-primary-rgb), 0.06);
  --novelist-tint-dark: rgba(var(--background-primary-rgb), 0.16);
  /* baseline for label column: padding-left + label width + column-gap
     matches the `.novelist-book-meta` grid (16px + 84px + 12px = 112px) */
  --novelist-padding: 16px;
  --novelist-label-width: 84px;
  --novelist-col-gap: 12px;
  --novelist-cover-width: 75px;
  --novelist-header-gap: 14px;
  --novelist-label-offset: calc(var(--novelist-padding) + var(--novelist-label-width) + var(--novelist-col-gap));
}

/* Neutralize outer workspace padding so our block paddings control layout
   Targets both possible data-type values to be robust */
.workspace-leaf-content[data-type="novelist-view"] .view-content,
.workspace-leaf-content[data-type="novelist"] .view-content {
  padding: 0 !important;
  /* make the view-content a flex column so .novelist-view can size correctly */
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow-x: hidden; /* prevent horizontal scrollbar from parent content */
}

/* Stronger layout guarantees: ensure our view and tree can shrink/grow inside Obsidian
   common flex pitfall: children need min-height:0 to allow overflow-y to work inside flex containers */
.workspace-leaf-content[data-type="novelist-view"] .view-content > .novelist-view,
.workspace-leaf-content[data-type="novelist"] .view-content > .novelist-view {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
  overflow-x: hidden; /* ensure the immediate child also hides horizontal overflow */
}

.novelist-view {
  min-height: 0;
}

.novelist-structure,
.novelist-tree {
  min-height: 0; /* allow these to shrink inside flex parents */
}

.novelist-tree {
  /* ensure tree fills remaining space and scrolls */
  flex: 1 1 auto;
  overflow-y: auto;
}

/* ===============================================================
   BOOK CONTAINER
=============================================================== */

.novelist-book {
  display: flex;
  flex-direction: column;
  gap: 16px;
  background: var(--background-secondary);
  border-radius: 14px;
  padding: 16px;
}




/* ===============================================================
   VOLUMES
=============================================================== */

.novelist-volumes {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

/* ===============================================================
  VOLUME CARD
=============================================================== */
.novelist-volume {
  background: var(--background-primary);
  border-radius: 12px;
  max-width: calc(100% - 8px);
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
  overflow-y: visible;
  -ms-overflow-style: none; /* IE/Edge hide scrollbar */
  scrollbar-width: none; /* Firefox hide scrollbar */
}

/* --- Book-Smith-like block structure --- */

/* toolbar block (alias for existing topbar) */
.novelist-toolbar,
.novelist-topbar {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 12px 16px;
  height: 62px; /* requested exact height */
  box-sizing: border-box;
  margin-bottom: 12px;
}

/* header block: cover + title block feel like a card */
.novelist-book-header {
  display: flex;
  gap: 14px;
  padding: 16px 16px 12px; /* header spacing per spec */
  margin-bottom: 12px;
  background: var(--background-secondary);
  border-radius: 10px;
  box-sizing: border-box;
  overflow: hidden;
  align-items: center;
  border-bottom: 1px solid var(--background-modifier-border);
  /* Reserve fixed space for the cover + title zone so it doesn't shrink */
  flex: 0 0 146px;
  max-height: 146px;
}

/* Align the header title block with the meta value column produced by the grid.
   Compute the left margin for the title block so its left edge lines up with
   the meta value column baseline (uses the variables defined above). */
.novelist-book-title-block {
  margin-left: calc(var(--novelist-label-offset) - (var(--novelist-padding) + var(--novelist-cover-width) + var(--novelist-header-gap)));
}

/* metadata block: leaner, compact */
.novelist-book-meta,
.novelist-book-info {
  padding: 12px 16px;
  margin-bottom: 0; /* remove gap so divider is flush with tree */
  display: flex;
  flex-direction: column;
  gap: 8px;
  opacity: 0.95;
  box-sizing: border-box;
  overflow: hidden;
  border-bottom: 1px solid var(--background-modifier-border);
}

/* Kill theme / Obsidian pseudo-element separators that inject a visual "|" or
   decorative divider around the metadata block. This prevents themes from
   drawing a separator when author/description are empty. */
.novelist-book-meta::before,
.novelist-book-meta::after,
.novelist-book-meta > *::before,
.novelist-book-meta > *::after {
  content: none !important;
  display: none !important;
}

/* Optional finer rule: if you only want to suppress separators for empty
   author/description nodes, keep these rules instead of the global ones above.
.novelist-book-author:empty::before,
.novelist-book-author:empty::after,
.novelist-book-description:empty::before,
.novelist-book-description:empty::after {
  content: none !important;
  display: none !important;
}
*/

/* cover sizing */
.novelist-book-cover,
.novelist-book-cover img {
  width: 75px;
  height: 105px;
  flex-shrink: 0;
  display: block;
  object-fit: cover;
  border-radius: 4px;
}

/* Placeholder styling for cover when no image exists. Ensure a visible
   black tile in light/day mode, and a subtle neutral in dark mode. */
.novelist-book-cover-placeholder,
.novelist-manage-cover-placeholder {
  background-color: rgba(0,0,0,0.9); /* default strong black fallback */
  background-image: none !important;
  border: 1px solid rgba(0,0,0,0.6);
  color: #fff;
}

@media (prefers-color-scheme: dark) {
  .novelist-book-cover-placeholder,
  .novelist-manage-cover-placeholder {
    /* in dark mode prefer a softer neutral so it doesn't feel 'heavy' */
    background-color: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.03);
    color: var(--text-normal);
  }
}
.novelist-book-title {
  font-size: 15px;
  line-height: 1.3;
  margin-bottom: 4px;
}
.novelist-book-subtitle {
  font-size: 12px;
  opacity: 0.7;
}

/* tree block: provide breathing room but no background */
.novelist-book-meta,
.novelist-book-info {
  padding: 12px 16px;
  margin-bottom: 0; /* remove gap so divider is flush with tree */
  display: flex;
  flex-direction: column;
  gap: 8px;
  opacity: 0.95;
  box-sizing: border-box;
  overflow: hidden;
  border-bottom: 1px solid var(--background-modifier-border);
}
/* stats / footer block */
.novelist-bottom-divider {
  height: 1px;
  margin: 8px 0;
  background: var(--background-modifier-border);
  opacity: 0.6;
}

.novelist-stats {
  /* Stats/footer: make flexible and tighten vertical spacing so content hugs the bottom */
  flex: none;
  min-height: 110px;
  /* slightly reduced top/bottom padding to remove the large bottom gap */
  padding: 14px 14px 8px; /* top 14, bottom 8 */
  margin-bottom: 4px;
  background-color: var(--background-secondary) !important;
  border-top: none; /* remove explicit top border to avoid stacked lines */
  box-sizing: border-box;
  overflow: hidden;
  position: relative;
  z-index: 0; /* keep stats visually below interactive tree area so tree receives clicks */
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); /* subtle top inset */
}

/* Ensure stats children fit the container and cannot force scrolling */
.novelist-stats,
.novelist-stats > * {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}

.novelist-stats .novelist-stat-row {
  overflow: hidden; /* ensure long labels/values don't create horizontal scroll */
}

.novelist-stat-label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.novelist-stat-value {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ensure tree sits above stats to receive clicks */
.novelist-tree { z-index: 2; overflow: visible; }
.novelist-structure {
  position: relative;
  z-index: 3;
}

/* stat row icon layout */
.novelist-stat-left {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  flex: 1 1 auto; /* allow left column to shrink */
  min-width: 0; /* critical to allow truncation inside flex */
}
.novelist-stat-icon {
  display: inline-flex;
  width: 12px; /* slightly larger for readability */
  height: 12px;
  align-items: center;
  justify-content: center;
}
.novelist-stat-icon-part {
  display: inline-flex;
  width: 10px; /* slightly larger composite parts */
  height: 10px;
  margin-right: 3px;
}

/* composite icon for topbar new button */
.novelist-top-icon-combo {
  position: relative;
  width: 20px;
  height: 20px;
  display: inline-block;
}
.novelist-top-icon-combo .file-icon {
  position: absolute;
  left: 0;
  top: 0;
  width: 20px;
  height: 20px;
}
.novelist-top-icon-combo .pencil-icon {
  position: absolute;
  right: -2px;
  bottom: -2px;
  width: 12px;
  height: 12px;
  opacity: 0.95;
}

/* Simple stat row layout */
.novelist-stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  padding: 5px 0; /* slightly tighter rows to lift content */
  border-bottom: 1px dashed rgba(var(--text-muted-rgb), 0.03);
}
.novelist-stat-row:last-child {
  border-bottom: none;
  padding-bottom: 2px;
}
.novelist-stat-label {
  color: var(--text-muted);
  font-size: 13px; /* increased for better readability */
  display: inline-flex;
  align-items: center; /* vertically center label with icon */
  line-height: 1; /* ensure consistent baseline */
}
.novelist-stat-value {
  color: var(--text-normal);
  font-weight: 600;
  font-size: 12px; /* slightly smaller value */
  flex: 0 0 auto; /* do not let value shrink below its content size */
  margin-left: 8px;
}

/* make sure icons and text align precisely */
.novelist-stat-icon svg,
.novelist-top-icon svg {
  /* use inline-block so vertical-align is honored (display:block causes it to be ignored) */
  display: inline-block;
  vertical-align: middle;
}

/* Nudge text slightly to visually center within the stat block */
.novelist-stat-label,
.novelist-stat-value { transform: translateY(-1px); }

/* ===============================================================
   VOLUME HEADER
=============================================================== */

.novelist-volume-title {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  cursor: pointer;
}

/* ❌ Kill any pseudo-toggle coming from CSS */
.novelist-volume-header::before,
.novelist-volume-header::after {
  content: none !important;
}

.novelist-volume-header {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  user-select: none;
}

.novelist-volume-toggle {
  width: 16px;
  text-align: center;
  font-size: 14px;
  opacity: 0.8;
}
.novelist-volume-title {
  font-size: 13px;
  font-weight: 600;
}


/* ===============================================================
   VOLUME CONTROLS
=============================================================== */

.novelist-volume-controls {
  display: flex;
  gap: 8px;
}

/* ===============================================================
   Manage Books & Edit Modal Styling (Book-Smith-like)
   Scoped to Novelist modal elements and classes created in main.js
=============================================================== */

/* Manage list container */
.novelist-manage-list {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-top: 14px;

/* Compact rows used by SwitchBookModal */
.novelist-switch-book-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 8px 18px 8px 18px; /* add right padding so Select button isn't flush to edge */
  border-bottom: 1px solid var(--background-modifier-border);
}
.novelist-switch-left {
  display: flex;
  flex-direction: column;
  gap: 2px;
  overflow: visible;
  min-width: 0;
}
.novelist-switch-title {
  font-weight: 600;
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.novelist-switch-title-row {
  display: flex;
  align-items: center;
  gap: 6px;
  min-width: 0;
}
.novelist-switch-dash {
  color: var(--text-muted);
}
.novelist-switch-subtitle {
  font-size: 13px;
  color: var(--text-muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 50ch;
}
.novelist-switch-meta {
  font-size: 11px;
  color: var(--text-muted);
  white-space: normal;
  overflow: hidden;
  display: -webkit-box;
  line-clamp: 2;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  margin-top: 4px; /* reduced gap between title and info */
}
.novelist-switch-meta,
.novelist-switch-meta-second {
  padding-left: 12px; /* indent info lines but keep title/subtitle aligned */
}
.novelist-switch-meta-second {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.novelist-switch-right {
  flex: 0 0 auto;
}
.novelist-switch-right > button { padding: 6px 10px; }
  max-height: 60vh;
  overflow: auto;
  padding-right: 6px;
}

/* Card */
.novelist-manage-card {
  display: flex;
  gap: 18px;
  background: var(--background-secondary);
  border-radius: 10px;
  padding: 14px;
  align-items: flex-start;
  box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset;
  border: 1px solid rgba(var(--background-modifier-border-rgb), 0.6);
  position: relative; /* enable absolute positioning for actions */
}

/* Placeholder when no books match the filter */
.novelist-manage-empty {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 36px 12px;
  color: var(--text-muted);
  font-style: italic;
}

.novelist-manage-left {
  width: 96px;
  min-width: 96px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.novelist-manage-cover {
  width: 84px;
  height: 112px;
  border-radius: 6px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
  background-size: cover;
  background-position: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.35);
  display: block;
}

.novelist-manage-right {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.novelist-manage-title {
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 0.2px;
}

.novelist-manage-subtitle {
  font-size: 13px;
  color: var(--text-muted);
}

.novelist-manage-meta-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.novelist-manage-author {
  color: var(--text-muted);
  font-size: 13px;
}

.novelist-manage-progress {
  color: var(--text-normal);
  font-weight: 600;
  font-size: 13px;
  white-space: nowrap;
}

.novelist-manage-desc {
  color: var(--text-muted);
  font-size: 13px;
  max-width: 80%;
  line-height: 1.35;
}

.novelist-manage-actions {
  display: flex;
  gap: 8px;
  margin-top: 6px;
}

/* Position actions on the card's right and vertically center on the card midline */
.novelist-manage-card > .novelist-manage-title-row > .novelist-manage-actions,
.novelist-manage-card .novelist-manage-actions {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  margin-top: 0; /* reset any top margin when absolutely positioned */
}

/* When actions live in the title row, remove top margin so they align horizontally */
.novelist-manage-title-row > .novelist-manage-actions { margin-top: 0; }

.novelist-manage-actions > button {
  min-width: 64px;
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
}

/* Use existing mod-danger class for delete; refine appearance */
.novelist-manage-actions > .mod-danger {
  background: linear-gradient(180deg, #ff5b5b, #e03b3b);
  color: white;
  border: none;
  box-shadow: 0 2px 0 rgba(0,0,0,0.25);
}

.novelist-manage-actions > button:not(.mod-danger) {
  background: var(--background-primary);
  color: var(--text-normal);
  border: 1px solid rgba(var(--background-modifier-border-rgb), 0.35);
}

/* Search input styling */
.novelist-manage-search {
  width: 56%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid rgba(var(--background-modifier-border-rgb), 0.5);
  background: var(--background-primary);
  color: var(--text-normal);
  box-sizing: border-box;
}

/* Modal form rows used by New/Edit modals */
.modal .novelist-modal-row {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 0;
  border-bottom: 1px solid rgba(var(--background-modifier-border-rgb), 0.06);
}
/* Theme-specific modal row divider colors: black in day, white in night */
/* Strong, visible dividers: black in day, white in night */
body.theme-light .modal .novelist-modal-row { border-bottom: 1px solid rgba(0,0,0,0.51) !important; }
body.theme-dark .modal .novelist-modal-row { border-bottom: 1px solid rgba(255,255,255,0.51) !important; }
.modal .novelist-modal-left {
  min-width: 200px;
  max-width: 260px;
  padding-left: 6px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.modal .novelist-modal-left .novelist-modal-row-title {
  font-weight: 600;
  margin-bottom: 6px;
  font-size: 15px;
}
.modal .novelist-modal-left .novelist-modal-row-sub {
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 4px;
}
.modal .novelist-modal-right {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}
.modal .novelist-modal-input,
.modal .novelist-modal-textarea,
.modal input[type="text"],
.modal textarea {
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid rgba(var(--background-modifier-border-rgb), 0.12);
  background: rgba(255,255,255,0.02);
  color: var(--text-normal);
  box-sizing: border-box;
  box-shadow: inset 0 1px 0 rgba(0,0,0,0.18);
}
.modal .novelist-modal-textarea { min-height: 92px; }

/* Cover select button styling inside modal right column */
.modal .novelist-modal-right button {
  align-self: flex-end;
  background: transparent;
  border: 1px solid rgba(var(--background-modifier-border-rgb), 0.12);
  padding: 8px 12px;
  border-radius: 10px;
  color: var(--text-normal);
}

/* Slightly increase spacing for rows to match screenshot rhythm */
.modal .novelist-modal-row + .novelist-modal-row { margin-top: 4px; }

/* Align action buttons for modal forms */
.modal .novelist-modal-actions,
.modal .modal-button-container {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding-top: 14px;
}

/* Small responsive tweaks */
@media (max-width: 720px) {
  .novelist-manage-search { width: 100%; margin-bottom: 8px; }
  .novelist-manage-card { flex-direction: column; align-items: center; }
  .novelist-manage-left { width: auto; }
  .modal .novelist-modal-left { display: none; }
  .modal .novelist-modal-row { flex-direction: column; align-items: stretch; }
}

/* cover placeholder */
.novelist-manage-cover-placeholder {
  display: flex !important;
  align-items: center;
  justify-content: center;
  color: rgba(var(--text-muted-rgb), 0.85);
  font-weight: 600;
  font-size: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
}

/* Title row: title left, subtitle right */
.novelist-manage-title-row {
  display: flex;
  justify-content: space-between;
  align-items: center; /* vertically center actions on the right */
  gap: 12px;
}
.novelist-manage-subtitle-right {
  font-size: 13px;
  color: var(--text-muted);
  margin-left: 12px;
}

/* Meta grid: labels left column, values right column */
.novelist-manage-meta-grid {
  display: grid;
  grid-template-columns: 96px 1fr;
  column-gap: 12px;
  row-gap: 6px;
  align-items: start;
}
.novelist-manage-labels { display: flex; flex-direction: column; gap: 6px; }
.novelist-manage-values { display: flex; flex-direction: column; gap: 6px; }
.novelist-manage-label { color: var(--text-muted); font-size: 13px; }

/* ensure description in values column wraps nicely */
.novelist-manage-values .novelist-manage-desc { max-width: 100%; }

/* End Manage Books / Edit modal enhancements */


.novelist-tree-folder .novelist-tree-icon.folder-icon {
  color: var(--text-normal);
}

.novelist-tree-file .novelist-tree-icon.file-icon {
  color: var(--text-muted);
}

.novelist-volume-controls input {
  flex: 1;
}

/* ===============================================================
   CHAPTER LIST
=============================================================== */

.novelist-chapter-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.novelist-chapter {
  padding: 6px 8px;
  border-radius: 6px;
  cursor: pointer;
}

.novelist-chapter:hover {
  background: var(--background-modifier-hover);
}
/* ===============================================================
   BOOK SELECTOR (BOOK-SMITH STYLE)
=============================================================== */

/* Wrapper select */
.novelist-view select {
  width: 100%;
  max-width: 100%;
  padding: 8px 12px;

  font-size: 0.95em;
  font-weight: 500;

  color: var(--text-normal);
  background-color: var(--background-secondary);

  border-radius: 10px;
  border: 1px solid var(--background-modifier-border);

  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  cursor: pointer;

  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.03),
    0 4px 12px rgba(0,0,0,0.2);

  margin-bottom: 12px;
}

/* Custom dropdown arrow */
.novelist-view select {
  background-image:
    linear-gradient(45deg, transparent 50%, var(--text-muted) 50%),
    linear-gradient(135deg, var(--text-muted) 50%, transparent 50%);
  background-position:
    calc(100% - 18px) calc(50% - 3px),
    calc(100% - 12px) calc(50% - 3px);
  background-size:
    6px 6px,
    6px 6px;
  background-repeat: no-repeat;
}

/* Hover */
.novelist-view select:hover {
  background-color: var(--background-secondary-alt);
}

/* Focus (keyboard & click) */
.novelist-view select:focus {
  outline: none;
  border-color: var(--interactive-accent);
  box-shadow:
    0 0 0 2px rgba(var(--interactive-accent-rgb), 0.25),
    inset 0 0 0 1px rgba(255,255,255,0.04);
}

/* Theme-sensitive backgrounds for cover zone and stats zone (single source of truth via CSS vars) */
body.theme-light .novelist-book-cover,
body.theme-light .novelist-stats {
  background-color: var(--novelist-tint-light);
}

body.theme-dark .novelist-book-cover,
body.theme-dark .novelist-stats {
  background-color: var(--novelist-tint-dark);
}
/* Overlay for cover to tint light/dark without removing the cover image (preserve inline background-image)
   Uses a pseudo-element so image remains visible and we can tint it. */
.novelist-book-cover::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 4px;
  pointer-events: none;
  transition: background-color 160ms ease;
}

body.theme-light .novelist-book-cover::after {
  background-color: var(--novelist-tint-light);
}

body.theme-dark .novelist-book-cover::after {
  background-color: var(--novelist-tint-dark);
}

/* Ensure the stats zone doesn't inherit patterned backgrounds from the workspace */
.novelist-stats {
  background-image: none !important;
}

/* Header overlay so the entire cover+title area tints like the stats zone */
.novelist-book-header {
  position: relative;
  overflow: hidden;
}
.novelist-book-header::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 10px;
  pointer-events: none;
  transition: background-color 160ms ease;
}

body.theme-light .novelist-book-header::after {
  background-color: var(--novelist-tint-light);
}

body.theme-dark .novelist-book-header::after {
  background-color: var(--novelist-tint-dark);
}

/* make divider between tree and stats explicit and slightly more visible */
.novelist-tree {
  border-bottom: 1px solid var(--background-modifier-border);
  opacity: 0.45; /* make the divider slightly lighter to avoid heavy bottom visual */
}

/* Reduce tree baseline padding so tree isn't overly centered */
.novelist-tree {
  /* Align tree to the start of the label column (the "Description" title)
     instead of the value column. */
  padding-left: var(--novelist-padding);
  padding-top: 10px; /* shift tree content down by 10px as requested */
}

.novelist-stats {
  border-top: 1px solid var(--background-modifier-border);
}

/* Topbar button icon spacing */
.novelist-top-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 8px;
}
.novelist-top-icon > svg {
  width: 16px;
  height: 16px;
}
.novelist-top-label {
  line-height: 1;
}

/* Switch modal rows: restore hover shadow and pointer affordance */
.novelist-switch-book-row {
  padding: 8px 10px;
  border-radius: 8px;
  cursor: pointer;
  transition: box-shadow 120ms ease, transform 80ms ease, background 120ms ease;
}
.novelist-switch-book-row:hover {
  background: var(--background-modifier-hover);
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}
.novelist-switch-book-row:active {
  transform: translateY(1px);
}

/* Minimal help button sizing inside topbar (icon-only) */
.novelist-help-btn {
  padding: 6px 10px;
  border-radius: 8px;
}
.novelist-help-icon > svg {
  width: 16px;
  height: 16px;
}


/* ===============================================================
   TOP BAR (Sticky App Controls)
=============================================================== */

.novelist-topbar {
  position: sticky;
  top: 0;
  z-index: 10;

  display: flex;
  gap: 8px;
  padding: 8px;
  justify-content: center;
  align-items: center;

  background: var(--background-secondary);
  border-bottom: 1px solid var(--background-modifier-border);

  margin: -16px -16px 16px;
}

.novelist-topbar button {
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 0.9em;
}

/* ===============================================================
   STRUCTURE TREE
=============================================================== */

.novelist-structure {
  display: flex;
  flex-direction: column;
  gap: 8px;
  /* allow the structure area to grow and scroll so it covers the interactive zone */
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
}

/* Structure container baseline padding (reduced) */
.novelist-structure {
  padding-left: var(--novelist-padding);
  padding-top: 10px; /* nudge tree content down */
  /* Structure aligned to label column start */
}

/* VOLUME */

.novelist-volume-row {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.novelist-volume-header {
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: default;
  user-select: none;
}

.novelist-volume-toggle {
  width: 16px;
  text-align: center;
  font-size: 13px;
  opacity: 0.8;
  cursor: pointer;
}

.novelist-volume-title {
  font-weight: 600;
  font-size: 1em;
}

/* CHAPTERS */

.novelist-chapter-list {
  display: flex;
  flex-direction: column;
  padding-left: 12px;
  gap: 2px;
}

.novelist-chapter-row {
  padding: 4px 6px;
  border-radius: 4px;
  cursor: pointer;
}

/* New book header layout (cover left, meta right) -- consolidated earlier; duplicate removed */

.novelist-book-cover-col {
  width: 75px; /* match Book Smith baseline */
  flex-shrink: 0;
}

.novelist-book-cover {
  width: 75px;
  height: 105px;
  border-radius: 4px;
  background: linear-gradient(160deg, #444, #222);
  background-size: cover;
  background-position: center;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
}

.novelist-book-meta {
  /* Use a two-column grid for label/value so alignment is exact and stable */
  display: grid;
  grid-template-columns: 84px 1fr;
  column-gap: 12px;
  align-items: center;
  flex: 0 0 auto;
  max-height: none;
  padding-top: 6px;
  overflow: visible;
  padding-left: 16px;
}

.novelist-book-title {
  font-size: 17px;
  font-weight: 600;
  letter-spacing: 0.03em;
  /* remove any computed top gap and keep small bottom gap */
  margin-top: 0 !important;
  margin-bottom: 4px;
}

.novelist-book-subtitle {
  font-size: 12px;
  opacity: 0.7;
}

.novelist-book-meta-below {
  margin-top: 12px;
}

.novelist-book-author,
.novelist-book-description {  font-size: 12px;
  opacity: 0.75;
  margin-bottom: 4px;
}
/* keep description line-height slightly looser for readability */
.novelist-book-description {
  line-height: 1.4;
  opacity: 0.6;
}

/* Meta input fields (Author / Description) */
.novelist-meta-row {
  display: contents; /* let the book-meta grid control layout for rows */
}
.novelist-meta-label {
  font-size: 13px;
  color: var(--text-normal); /* use normal text color (white in dark themes) */
  text-transform: none;
  align-self: center;
}
.novelist-meta-value {
  flex: 1 1 auto;
  font-size: 13px;
  color: var(--text-normal);
}
.novelist-meta-desc {
  white-space: pre-wrap;
  line-height: 1.3;
  opacity: 0.85;
  align-self: flex-start; /* keep multi-line descriptions top-aligned */
}

/* Ensure meta values have no extra padding/margin or text-indent so Author and Description align */
.novelist-meta-value,
.novelist-meta-desc {
  display: block;
  margin: 0;
  padding: 0;
  text-indent: 0;
  grid-column: 2 / 3;
}

.novelist-meta-desc { align-self: start; }

.novelist-chapter-row:hover {
  background: var(--background-modifier-hover);
}

/* ===============================================================
   EDITORIAL TREE STYLES
=============================================================== */

.novelist-tree-file,
.novelist-tree-folder {
  padding: 4px 6px;
  cursor: pointer;
  border-radius: 4px;
}

.novelist-tree-file:hover,
.novelist-tree-folder:hover {
  background: rgba(255,255,255,0.05);
}

.novelist-tree-children {
  /* Indent children so their labels line up with the parent folder label
     We base this on the tree icon size + spacing so alignment stays consistent. */
  /* balanced indent between folder icon and label — tuned to sit in the middle */
  margin-left: calc(var(--tree-icon-size) + 18px);
  position: relative;
  padding-left: 0;
}

/* vertical connector line for tree levels */
.novelist-tree-children::before {
  content: "";
  position: absolute;
  /* place connector between the toggle caret and the folder icon */
  left: calc(-1 * var(--tree-icon-size) + 6px);
  top: 8px; /* inset so the line aligns with icon center */
  bottom: 8px;
  width: 2px;
  background: linear-gradient(to bottom, rgba(var(--background-modifier-border-rgb, 255,255,255), 0.08), rgba(var(--background-modifier-border-rgb, 255,255,255), 0.02));
  opacity: 0.9;
  display: none;
  pointer-events: none;
}

/* show the connector for any children container when it is open */
.novelist-tree-children.is-open::before {
  display: block;
}

/* Theme-specific tweaks so connector is visible in both light and dark themes */
body.theme-dark .novelist-tree-children::before {
  background: linear-gradient(to bottom, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
}
body.theme-light .novelist-tree-children::before {
  background: linear-gradient(to bottom, rgba(0,0,0,0.09), rgba(0,0,0,0.03));
}

/* Icon next to file/folder name */
.novelist-tree-icon {
  width: 18px;
  display: inline-block;
  text-align: center;
  margin-right: 8px;
  flex-shrink: 0;
}

/* Toggle caret for folders */
.novelist-tree-toggle {
  width: 18px;
  display: inline-block;
  text-align: center;
  margin-right: 8px;
  color: var(--text-muted);
  cursor: pointer;
}

.novelist-tree-folder > .novelist-tree-toggle {
  transform-origin: center;
}

/* Use Obsidian's native Lucide icons via setIcon; keep minimal sizing rules for SVGs */
:root {
  --tree-icon-size: 16px;
  --tree-icon-color: rgba(255,255,255,0.75);
  --tree-icon-color-active: var(--interactive-accent);
}

.novelist-tree-icon,
.novelist-tree-toggle {
  width: var(--tree-icon-size);
  height: var(--tree-icon-size);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  vertical-align: middle;
  margin-right: 8px;
}

.novelist-tree-icon svg,
.novelist-tree-toggle svg {
  width: var(--tree-icon-size);
  height: var(--tree-icon-size);
  opacity: 0.95;
}

/* colors on hover / active to match Book Smith feel */
.novelist-tree-file,
.novelist-tree-folder {
  color: var(--text-normal);
}

.novelist-tree-file:hover,
.novelist-tree-folder:hover {
  background: rgba(255,255,255,0.03);
}

.novelist-tree-file.is-active > .novelist-tree-icon,
.novelist-tree-folder.is-active > .novelist-tree-toggle {
  color: var(--tree-icon-color-active);
}

.novelist-tree-misc {
  opacity: 0.4;
  font-style: italic;
}
/* ===============================================================
   VIEW SCROLL STABILITY
=============================================================== */

.novelist-divider {
  height: 1px;
  margin: 16px 0;
  background: var(--background-modifier-border);
  opacity: 0.1;
}

/* Modal layout for New Book / Edit Book */
.novelist-modal-row {
  display: grid;
  grid-template-columns: 1fr 320px; /* left label column, right control column */
  column-gap: 18px;
  align-items: center;
  padding: 14px 0;
}
.novelist-modal-left {
  display: flex;
  flex-direction: column;
}
.novelist-modal-row-title {
  font-weight: 600;
  font-size: 14px;
}
.novelist-modal-row-sub {
  font-size: 12px;
  opacity: 0.7;
}
.novelist-modal-right {
  display: flex;
  justify-content: flex-end;
  align-items: center;
}
.novelist-template-select,
.novelist-modal-input,
.novelist-modal-textarea {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}
.novelist-modal-textarea {
  height: 96px;
  resize: vertical;
}
.novelist-modal-divider {
  height: 1px;
  background: var(--background-modifier-border);
  opacity: 0.08;
  margin: 8px 0 8px 0;
}
.novelist-modal-actions {
  display: flex;
  justify-content: flex-end;
  padding-top: 12px;
}
.novelist-modal-create {
  min-width: 110px;
}

.novelist-stats {
  margin-top: auto;
  padding: 12px 16px;
  background: var(--background-secondary);
  border-top: 1px solid var(--background-modifier-border);
}
/* cleaned stray tokens above; switch row hover defined elsewhere */

/* ===============================================================
   TREE ACTIONS
=============================================================== */

.novelist-add-volume,
.novelist-add-chapter {
  margin-left: 22px;
  font-size: 0.85em;
  opacity: 0.6;
  cursor: pointer;
}

.novelist-add-volume:hover,
.novelist-add-chapter:hover {
  opacity: 1;
}
/* ===============================================================
   ACTIVE CHAPTER
=============================================================== */

.novelist-chapter-row.is-active {
  background: var(--background-modifier-active-hover);
  font-weight: 600;
}

/* Manage modal: subtitle inline with title but visually aligned with meta values */
.novelist-manage-title-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
}
.novelist-manage-subtitle-right {
  font-size: 12px;
  color: var(--text-muted);
  margin-left: 8px;
  margin-top: 10px; /* nudge down to visually align with Author/Description text */
  line-height: 1.2;
}
.novelist-manage-meta-grid {
  display: flex;
  gap: 12px;
  margin-top: 6px;
}
.novelist-manage-labels {
  width: var(--novelist-label-width);
  display: flex;
  flex-direction: column;
  gap: 8px;
  color: var(--text-muted);
  font-size: 13px;
}
.novelist-manage-values {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* Layout tweaks to ensure subtitle sits inline with the title without pushing values */
.novelist-manage-card {
  display: flex;
  gap: 16px;
  align-items: flex-start;
  padding: 14px 18px;
  border-radius: 8px;
}
.novelist-manage-left {
  flex: 0 0 var(--novelist-cover-width);
}
.novelist-manage-right {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
}
.novelist-manage-title-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
}
.novelist-manage-title {
  font-weight: 700;
  font-size: 18px;
  line-height: 1.1;
  margin-right: 8px;
  flex: 0 1 auto;
}
.novelist-manage-subtitle-right {
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 6px; /* smaller nudge to align with meta values */
  line-height: 1.2;
  white-space: nowrap;
}

/* ===============================================================
   DRAG AND DROP STYLES (Book-Smith pattern)
=============================================================== */

/* Dragging state */
.novelist-dragging {
  opacity: 0.5;
  position: relative;
  z-index: 1000;
  transform: translateZ(0);
  transition: none;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  will-change: transform;
}

/* General dragover state */
.novelist-dragover {
  background-color: var(--interactive-accent-hover);
  transition: background-color 0.1s ease;
}

/* Drop zone indicators */
.novelist-dragover-before {
  position: relative;
  transition: all 0.1s ease;
}

.novelist-dragover-before::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background-color: var(--interactive-accent);
  box-shadow: 0 0 3px var(--interactive-accent);
}

.novelist-dragover-after {
  position: relative;
  transition: all 0.1s ease;
}

.novelist-dragover-after::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2px;
  background-color: var(--interactive-accent);
  box-shadow: 0 0 3px var(--interactive-accent);
}

.novelist-dragover-inside {
  background-color: var(--interactive-accent-hover);
  opacity: 0.5;
  transition: all 0.1s ease;
}

/* Tree items should have grab cursor when draggable */
.novelist-tree-file,
.novelist-tree-folder {
  cursor: grab;
}

.novelist-tree-file:active,
.novelist-tree-folder:active {
  cursor: grabbing;
}

/* Exclude from stats visual indicator */
.novelist-tree-label.exclude-from-stats {
  color: var(--text-muted);
  opacity: 0.8;
}

.novelist-tree-label.exclude-from-stats::after {
  content: '';
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  background-color: var(--text-muted);
  opacity: 0.6;
  mask-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-minus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>');
  mask-size: contain;
  mask-repeat: no-repeat;
  mask-position: center;
}

/* Completed/done indicator */
.novelist-tree-label.is-done::after {
  content: '';
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  background-color: var(--color-green);
  opacity: 0.6;
  mask-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>');
  mask-size: contain;
  mask-repeat: no-repeat;
  mask-position: center;
}

/* Ensure label has room for status indicators */
.novelist-tree-label {
  position: relative;
  padding-right: 20px;
}
/* ===============================================================
   WRITER TOOLS VIEW
=============================================================== */

.novelist-writer-tools {
  padding: 20px;
  height: 100%;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.writer-tools-header {
  border-bottom: 1px solid var(--background-modifier-border);
  padding-bottom: 12px;
  margin-bottom: 8px;
}

.writer-tools-header h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: var(--text-normal);
}

.writer-tools-container {
  display: flex;
  flex-direction: column;
  gap: 20px;
  flex: 1;
}

.writer-tools-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  opacity: 0.5;
}

.writer-tools-placeholder-text {
  margin: 0;
  font-size: 14px;
  color: var(--text-muted);
}

/* Tool sections */
.writer-tool {
  background: var(--background-secondary);
  border: 1px solid var(--background-modifier-border);
  border-radius: 6px;
  padding: 16px;
}

.writer-tool h3 {
  margin: 0 0 12px 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--text-normal);
}